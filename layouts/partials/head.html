const parameters = { 
    grid: 9, 
    circleSize: 5, 
    circleBorder: 6,
    backgroundColor: '#000000',
    lineColor: '#595959',
    circleColor: '#ffffff'
  };
  const gui = new dat.GUI();
  const gridController = gui.add(parameters, 'grid').min(1).max(100).step(1).name('Grid Size');
  const circleSizeController = gui.add(parameters, 'circleSize').min(1).max(50).step(1).name('Circle Size');
  const circleBorderController = gui.add(parameters, 'circleBorder').min(0).max(10).step(1).name('Circle Border');
  const backgroundColorController = gui.addColor(parameters, 'backgroundColor').name('Background');
  const lineColorController = gui.addColor(parameters, 'lineColor').name('Line');
  const circleColorController = gui.addColor(parameters, 'circleColor').name('Circle');
  
  gui.add({download:function(){ downloadSVG(); }},'download').name('Download SVG');
  
  const svg = document.getElementById('svg');
  gridController.onChange(value => drawGrid(value));
  circleSizeController.onChange(value => drawGrid(parameters.grid));
  circleBorderController.onChange(value => drawGrid(parameters.grid));
  backgroundColorController.onChange(value => drawGrid(parameters.grid));
  lineColorController.onChange(value => drawGrid(parameters.grid));
  circleColorController.onChange(value => drawGrid(parameters.grid));
  
  drawGrid(parameters.grid);
  
  function drawGrid(gridSize) {
    svg.innerHTML = '';
    const width = svg.clientWidth;
    const height = svg.clientHeight;
    const cellWidth = width / gridSize;
    const cellHeight = height / gridSize;
    for(let i=0; i<=gridSize; i++) {
      for(let j=0; j<=gridSize; j++) {
        if (i < gridSize && j < gridSize) {
          const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
          rect.setAttribute('x', i * cellWidth);
          rect.setAttribute('y', j * cellHeight);
          rect.setAttribute('width', cellWidth);
          rect.setAttribute('height', cellHeight);
          rect.setAttribute('fill', parameters.backgroundColor);
          rect.setAttribute('stroke', parameters.lineColor);
          svg.appendChild(rect);
        }
        const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
        circle.setAttribute('cx', i * cellWidth);
        circle.setAttribute('cy', j * cellHeight);
        circle.setAttribute('r', parameters.circleSize);
        circle.setAttribute('fill', parameters.circleColor);
        circle.setAttribute('stroke', parameters.backgroundColor);
        circle.setAttribute('stroke-width', parameters.circleBorder);
        svg.appendChild(circle);
      }
    }
  }
  
  function downloadSVG() {
    const serializer = new XMLSerializer();
    const source = serializer.serializeToString(svg);
    const blob = new Blob([source], {type: "image/svg+xml;charset=utf-8"});
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = 'grid.svg';
    link.click();
  }