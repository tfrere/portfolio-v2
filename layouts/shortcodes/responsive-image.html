{{- $image_src := .Get "src" -}}

{{- /* Find all files with filename (without suffix) matching "src" parameter. */ -}}
{{- $image_files := (.Page.Resources.Match (printf "%s*" $image_src)) -}}

{{- /* Find in page bundle all valid video files with matching name. */ -}}
{{ with $image_files }}
    {{ range $image := . }}
        <!-- variables used for img tag -->
        {{ $imgSrc := "" }}
        {{ $imgSrcSet := slice }}

        <!-- uses settings from config.toml depending on orientation -->
        {{ $widths := $.Site.Params.landscapePhotoWidths }}
        {{ if gt $image.Height $image.Width }}
        {{ $widths = $.Site.Params.portraitPhotoWidths }}
        {{ end }}

        <!--
        Add URL for each width to $imgSrcSet variable
        format: "/path/img_1000.jpg 1000w,/path/img_500.jpg 500w"
        Note: the first URL is used as "fallback" src in $imgSrc.
        -->
        {{ range $widths }}
        {{ $srcUrl := (printf "%dx" . | $image.Resize).RelPermalink }}
        {{ if eq $imgSrc "" }}{{ $imgSrc = $srcUrl }}{{ end }}
        {{ $imgSrcSet = $imgSrcSet | append (printf "%s %dw" $srcUrl .) }}
        {{ end }}
        {{ $imgSrcSet = (delimit $imgSrcSet ",") }}

        <img alt="" class="lazy" src="{{ $imgSrc }}" srcset="{{ $imgSrcSet }}" >

    {{ end }}
{{ end }}

